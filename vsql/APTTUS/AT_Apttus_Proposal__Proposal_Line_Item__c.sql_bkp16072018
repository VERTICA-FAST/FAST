/****
****Script Name	  : AT_Apttus_Proposal__Proposal_Line_Item__c.sql
****Description   : Incremental data load for AT_Apttus_Proposal__Proposal_Line_Item__c
****/

/* Setting timing on**/
\timing

\set ON_ERROR_STOP on

CREATE LOCAL TEMP TABLE Start_Time_Tmp ON COMMIT PRESERVE ROWS AS select count(*) count, sysdate st from "swt_rpt_stg"."AT_Apttus_Proposal__Proposal_Line_Item__c";

/* Inserting values into the Audit table  */

INSERT INTO swt_rpt_stg.FAST_LD_AUDT
(
SUBJECT_AREA
,TBL_NM
,LD_DT
,START_DT_TIME
,END_DT_TIME
,SRC_REC_CNT
,TGT_REC_CNT
,COMPLTN_STAT
)
select 'APTTUS','AT_Apttus_Proposal__Proposal_Line_Item__c',sysdate::date,sysdate,null,(select count from Start_Time_Tmp) ,null,'N';

Commit;

INSERT /*+DIRECT*/ INTO "swt_rpt_stg".AT_Apttus_Proposal__Proposal_Line_Item__c_Hist select * from "swt_rpt_stg".AT_Apttus_Proposal__Proposal_Line_Item__c;
COMMIT;

CREATE LOCAL TEMP TABLE duplicates_records ON COMMIT PRESERVE ROWS AS (
select id,max(auto_id) as auto_id from swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c where id in (
select id from swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c group by id,LASTMODIFIEDDATE having count(1)>1)
group by id);

delete from swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c where exists(
select 1 from duplicates_records t2 where swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c.id=t2.id and swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c.auto_id<t2.auto_id);

commit;


CREATE LOCAL TEMP TABLE AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp ON COMMIT PRESERVE ROWS AS
(
SELECT DISTINCT * FROM swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c)
SEGMENTED BY HASH(ID,LastModifiedDate) ALL NODES;

TRUNCATE TABLE swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c;

CREATE LOCAL TEMP TABLE AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp ON COMMIT PRESERVE ROWS AS
(
SELECT DISTINCT ID,LastModifiedDate FROM swt_rpt_base.AT_Apttus_Proposal__Proposal_Line_Item__c)
SEGMENTED BY HASH(ID,LastModifiedDate) ALL NODES;


CREATE LOCAL TEMP TABLE AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp_Key ON COMMIT PRESERVE ROWS AS
(
SELECT id, max(LastModifiedDate) as LastModifiedDate FROM AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp group by id)
SEGMENTED BY HASH(ID,LastModifiedDate) ALL NODES;


/* Inserting deleted Stage table data into Historical Table */

insert /*+DIRECT*/ into swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c_Hist
(
Id
,Apttus_QPConfig__AssetLineItemId__c
,Apttus_QPConfig__BaseProductId__c
,Apttus_QPConfig__BillingPlanId__c
,Apttus_QPConfig__ClassificationId__c
,Apttus_QPConfig__ConfigurationId__c
,Apttus_QPConfig__DerivedFromId__c
,Apttus_QPConfig__IncentiveId__c
,Apttus_QPConfig__OptionId__c
,SWT_ParentProposalLineItem__c
,Apttus_QPConfig__PriceListItemId__c
,Apttus_Proposal__Product__c
,Apttus_QPConfig__ProductOptionId__c
,Apttus_Proposal__Proposal__c
,Apttus_QPConfig__SummaryGroupId__c
,Apttus_QPConfig__TaxCodeId__c
,CreatedById
,CurrencyIsoCode
,LastModifiedById
,SWT_Additional_Discount__c
,SWT_Additional_Discount_Percentage__c
,Apttus_QPConfig__AdjustedPrice__c
,Apttus_QPConfig__AdjustmentAmount__c
,Apttus_QPConfig__AdjustmentType__c
,SWT_Advanced_Support_Resource__c
,Apttus_QPApprov__Approval_Status__c
,SWT_Authority_Currency_Code__c
,Apttus_QPConfig__AutoActivateOrder__c
,Apttus_QPConfig__AutoCreateBill__c
,Apttus_QPConfig__AutoCreateRevenue__c
,Apttus_QPConfig__AutoRenew__c
,Apttus_QPConfig__AutoRenewalTerm__c
,Apttus_QPConfig__AutoRenewalType__c
,Apttus_QPConfig__BaseCost__c
,Apttus_QPConfig__BaseCostOverride__c
,Apttus_QPConfig__BaseExtendedCost__c
,Apttus_QPConfig__BaseExtendedPrice__c
,Apttus_QPConfig__BasePrice__c
,Apttus_QPConfig__BasePriceOverride__c
,Apttus_QPConfig__BasePriceMethod__c
,Apttus_QPConfig__BillingFrequency__c
,Apttus_QPConfig__BillingPreferenceId__c
,Apttus_QPConfig__BillingRule__c
,Apttus_QPConfig__BillToAccountId__c
,SWT_Business_Area__c
,Apttus_QPConfig__ClassificationHierarchy__c
,SWT_Channel_CMT_MD_Lead_Queue__c
,SWT_Channel_Manager_Queue__c
,Apttus_QPConfig__ChargeType__c
,SWT_CMT_MD_Lead_Queue__c
,Apttus_QPConfig__Comments__c
,Apttus_QPConfig__CommitmentQuantity__c
,SWT_Container_Lines__c
,Apttus_QPConfig__ContractNumbers__c
,SWT_Contractual_Discount_Amount__c
,SWT_Contractual_Discount_Percentage__c
,Apttus_QPConfig__Cost__c
,Apttus_QPConfig__CouponCode__c
,SWT_CSR_Approvals__c
,SWT_CSR_Compensation__c
,SWT_Customer_Account_Reference__c
,SWT_Deal_Desk__c
,Apttus_QPConfig__DeltaPrice__c
,Apttus_QPConfig__DeltaQuantity__c
,Apttus_Proposal__Description__c
,SWT_Ad_Disc__c
,SWT_Cont_Disc__c
,SWT_Display_Disc_Perc__c
,SWT_Pr_Disc__c
,Apttus_QPConfig__EndDate__c
,Apttus_QPConfig__ExtendedCost__c
,Apttus_QPConfig__ExtendedDescription__c
,SWT_Extended_List_Price__c
,Apttus_QPConfig__ExtendedPrice__c
,SWT_Extended_Price_Template__c
,Apttus_QPConfig__ExtendedQuantity__c
,Apttus_Proposal__Ext_Net_Price__c
,Apttus_Proposal__Ext_Price__c
,SWT_First_Line_Manager_Queue__c
,Apttus_QPConfig__FlatOptionPrice__c
,Apttus_QPConfig__GroupAdjustmentPercent__c
,Apttus_QPConfig__Guidance__c
,Apttus_QPConfig__HasAttributes__c
,Apttus_QPConfig__HasIncentives__c
,Apttus_QPConfig__HasOptions__c
,Apttus_QPConfig__HideInvoiceDisplay__c
,SWT_HPE_Grace_Period__c
,SWT_HPE_RampUp__c
,Apttus_QPConfig__IncentiveAdjustmentAmount__c
,Apttus_QPConfig__IncentiveCode__c
,Apttus_QPConfig__IncentiveExtendedPrice__c
,Apttus_QPConfig__IncentiveType__c
,Apttus_QPConfig__IsAssetPricing__c
,Apttus_QPConfig__IsCustomPricing__c
,Apttus_QPConfig__IsOptionRollupLine__c
,Apttus_QPConfig__IsPrimaryLine__c
,Apttus_QPConfig__IsPrimaryRampLine__c
,Apttus_QPConfig__IsUsageTierModifiable__c
,Apttus_QPConfig__ItemSequence__c
,SWT_Jurisdiction_Text__c
,SWT_License_List_Price__c
,SWT_License_Net_Price__c
,Apttus_QPConfig__LineNumber__c
,Apttus_QPConfig__LineStatus__c
,Apttus_QPConfig__LineType__c
,Apttus_QPConfig__ListPrice__c
,SWT_List_Price_Template__c
,Apttus_QPConfig__LocationId__c
,SWT_Merged_Subscription__c
,Apttus_QPConfig__NetAdjustmentPercent__c
,Apttus_QPConfig__NetPrice__c
,SWT_Net_Price_Template__c
,Apttus_QPConfig__NetUnitPrice__c
,Apttus_QPConfig__OptionCost__c
,Apttus_QPConfig__OptionPrice__c
,SWT_Orange_Band_Threshold__c
,SWT_OrangeThresholdCheck__c
,SWT_OrangeThresholdCheckForSupport__c
,Apttus_QPConfig__ParentBundleNumber__c
,SWT_Partner_Discount_Amount__c
,SWT_Partner_Discount_Percentage__c
,Apttus_QPConfig__PaymentTermId__c
,SWT_Percentage_of_License_Net__c
,SWT_Percentage_Values__c
,Apttus_QPConfig__PriceAdjustment__c
,Apttus_QPConfig__PriceAdjustmentAmount__c
,Apttus_QPConfig__PriceAdjustmentType__c
,Apttus_QPConfig__PriceGroup__c
,Apttus_QPConfig__PriceIncludedInBundle__c
,Apttus_QPConfig__PriceListId__c
,Apttus_QPConfig__PriceMethod__c
,Apttus_QPConfig__PriceType__c
,Apttus_QPConfig__PricingDate__c
,Apttus_QPConfig__Frequency__c
,SWT_Pricing_Method__c
,Apttus_QPConfig__Term__c
,Apttus_QPConfig__PriceUom__c
,Apttus_QPConfig__PrimaryLineNumber__c
,SWT_Product_Code__c
,SWT_Product_Config_Type__c
,SWT_PL__c
,SWT_Product_Name_on_Template__c
,SWT_ProductRatePlanChargeID__c
,SWT_Product_Rate_Plan_Charge_ID__c
,SWT_Product_Sub_Type__c
,SWT_Product_Type__c
,SWT_Product_Type_Business__c
,SWT_ProductTypeForApprovals__c
,Apttus_QPConfig__Uom__c
,SWT_Promotional_Discount_Percentage__c
,SWT_Promotion_Discount_Amount__c
,SWT_PS_Level_2_Queue__c
,Apttus_Proposal__Quantity__c
,Apttus_QPConfig__Quantity2__c
,Quantity_Display__c
,Apttus_QPConfig__ReadyForActivationDate__c
,Apttus_QPConfig__ReadyForBillingDate__c
,Apttus_QPConfig__ReadyForFulfillmentDate__c
,Apttus_QPConfig__ReadyForRevRecDate__c
,SWT_Red_Band_Threshold__c
,SWT_RedThresholdCheck__c
,SWT_RedThresholdCheckForSupport__c
,SWT_RedThresholdCheckL3__c
,SWT_RedThresholdCheckL4__c
,SWT_RelatedProduct__c
,Apttus_QPConfig__RenewalAdjustmentAmount__c
,Apttus_QPConfig__RenewalAdjustmentType__c
,SWT_Return_to_Support__c
,SWT_SAAS_Approvals_Check__c
,SWT_Saas_L2_Approvals_Check__c
,Apttus_Proposal__Sales_Discount__c
,Apttus_QPConfig__SellingFrequency__c
,Apttus_QPConfig__SellingTerm__c
,Apttus_Proposal__Service_Date__c
,Apttus_QPConfig__ShipToAccountId__c
,SWT_Ship_To_Address__c
,Apttus_QPConfig__StartDate__c
,SWT_Support_Entitlement_ID__c
,SWT_Support_List_Price__c
,SWT_Support_Net_Price__c
,Apttus_QPConfig__Taxable__c
,SWT_Tax_Amount__c
,SWT_Tax_Code__c
,Apttus_QPConfig__TaxInclusive__c
,SWT_Tax_Rate__c
,SWT_Tax_Rate_Code__c
,SWT_Tax_Type__c
,SWT_Term_Template__c
,SWT_Tier_Type__c
,SWT_Total_Discount_Amount__c
,SWT_Total_Discount_Percentage__c
,Apttus_Proposal__Unit_Net_Price__c
,Apttus_Proposal__Unit_Price__c
,SWT_UOM_SoldByQuantity__c
,SW_UpfrontBilling__c
,SWT_VSOE_lower_band__c
,SWT_VSOE_upper_band__c
,SWT_VSOE_Value_Pricing__c
,SWT_Yellow_Band_Threshold__c
,SWT_YellowThresholdCheck__c
,SWT_YellowThresholdCheckForSupport__c
,SWT_ZuoraProductRatePlanID__c
,SWT_Zuora_Rate_Plan_Charge_ID__c
,LastModifiedDate
,SWT_Entitlement_Id__c
,SWT_Previous_Year_License_Net_Price__c
,SWT_Previous_Year_Support_Net_Price__c
,SWT_Is_Premier_Support__c
,SWT_O_Threshold_for_Display__c
,SWT_R_Threshold_for_Display__c
,SWT_Y_Threshold_for_Display__c
,SWT_Legacy_SAID__c
,SWT_Price_Method__c
,SWT_Product_Code_Sub_Type__c
,SWT_Asset_Line_Item__c
,SWT_ProductPillars__c
,SWT_DataSheets__c
,SWT_Skus__c
,SWT_Support_Business_Area__c
,SWT_Product_Tax_Code__c
,SWT_Expected_Start_Date__c
,SWT_SellingTerm__c
,SWT_Resource__c
,SWT_Expected_End_Date__c
,SWT_Quantity_Reduced__c
,SWT_SmartDiscount_Match__c
,SWT_SmartDiscount_Link__c
,SWT_Initial_Quantity_New_Business__c
,SWT_Product_Detail_Code__c
,SWT_UOM_code__c
,SWT_Profit_Center__c
,SWT_Remaining_Quantity__c
,SWT_Billing_Plan__c
,SWT_Sold_By_Pack__c
,SWT_Non_VSOE_Compliant__c
,SWT_Is_Renewed_Migrated__c
,SWT_Expected_Unit_Price_for_Renewals__c
,SWT_Previous_Year_Unit_Net_Price__c
,SWT_Net_Price_Xauthor__c
,SWT_Previous_Year_Support_Net_Xauthor__c
,SWT_Previous_Year_License_Net_Xauthor__c
,SWT_Product_Name__c
,SWT_Selling_Term__c
,SWT_Initial_Quantity_NB_Xauthor__c
,SWT_Quantity__c
,SWT_EOL_Date__c
,Name
,SWT_ELA_Agreement_Name__c
,SWT_ELA_Line_Item_Original_Balance__c
,SWT_ELA_Adjustment_Quantity__c
,SWT_ELA_Upper_Fence__c
,SWT_ELA_Lower_Fence__c
,SWT_ELA_Maximum_Quantity__c
,SWT_ELA_Complimentary__c
,SWT_ELA_Complimetary_Discount__c
,SWT_ELA_Complimetary_Product_Price__c
,SWT_Product_Billing_Plan__c
,SWT_Promotional_Discount_Checkbox__c
,SWT_Additional_Discount_Checkbox__c
,SWT_Contractual_Discount_Checkbox__c
,SWT_Program_Discount_Checkbox__c
,SWT_Royalty_Bearing_or_Fixed_Quantity_1__c
,SWT_Cancellation_Note_xauthor__c
,SWT_Cancellation_Reason_xauthor__c
,SWT_Cancellation_Type_xauthor__c
,SWT_Charge_Description__c
,IsDeleted
,CreatedDate
,SystemModstamp
,LastActivityDate
,Apttus_QPConfig__AssetId__c
,Apttus_QPConfig__AttributeValueId__c
,Apttus_QPConfig__ChargeGroupId__c
,SWT_Total_Discount_Value__c
,Apttus_QPConfig__ServiceLocationId__c
,SWT_Support_Level__c
,SWT_FamilyDescs__c
,SAAS_L4_BU_GM_Approval__c
,SWT_RenewalAdditionalAdjustmentType__c
,SWT_Program_Discount_Amount__c
,SWT_Program_Discount_Percentage__c
,SWT_RenewalAdditionalDiscount__c
,SWT_Renewal_Adjustment_Amount__c
,SWT_Renewal_Adjustment_Percentage__c
,Apttus_QPConfig__IsOptional__c
,SWT_Zuora_Subscription_Rate_Plan_ID__c
,SWT_Original_Quantity__c
,SWT_Appliance_Serial_Number__c
,SWT_Ship_To_Xauthor__c
,SWT_Renewing_EL_Product__c
,SWT_Proposal_Line_Item__c
,SWT_Discount_Level__c
,SWT_Discount_Level_Number__c
,SWT_Education_Approval_Check_1__c
,SWT_PS_Level_2_Approval_Check__c
,SWT_PS_Level_3_Approval_Check__c
,SWT_LI_Approval_Status__c
,SWT_Control_Tower_ID__c
,SWT_Line_Type__c
,SWT_Termination_Quantity__c
,SWT_Initial_Zuora_Rate_Plan_Charge_ID__c
,LD_DT
,SWT_INS_DT
,d_source
)
select
Id
,Apttus_QPConfig__AssetLineItemId__c
,Apttus_QPConfig__BaseProductId__c
,Apttus_QPConfig__BillingPlanId__c
,Apttus_QPConfig__ClassificationId__c
,Apttus_QPConfig__ConfigurationId__c
,Apttus_QPConfig__DerivedFromId__c
,Apttus_QPConfig__IncentiveId__c
,Apttus_QPConfig__OptionId__c
,SWT_ParentProposalLineItem__c
,Apttus_QPConfig__PriceListItemId__c
,Apttus_Proposal__Product__c
,Apttus_QPConfig__ProductOptionId__c
,Apttus_Proposal__Proposal__c
,Apttus_QPConfig__SummaryGroupId__c
,Apttus_QPConfig__TaxCodeId__c
,CreatedById
,CurrencyIsoCode
,LastModifiedById
,SWT_Additional_Discount__c
,SWT_Additional_Discount_Percentage__c
,Apttus_QPConfig__AdjustedPrice__c
,Apttus_QPConfig__AdjustmentAmount__c
,Apttus_QPConfig__AdjustmentType__c
,SWT_Advanced_Support_Resource__c
,Apttus_QPApprov__Approval_Status__c
,SWT_Authority_Currency_Code__c
,Apttus_QPConfig__AutoActivateOrder__c
,Apttus_QPConfig__AutoCreateBill__c
,Apttus_QPConfig__AutoCreateRevenue__c
,Apttus_QPConfig__AutoRenew__c
,Apttus_QPConfig__AutoRenewalTerm__c
,Apttus_QPConfig__AutoRenewalType__c
,Apttus_QPConfig__BaseCost__c
,Apttus_QPConfig__BaseCostOverride__c
,Apttus_QPConfig__BaseExtendedCost__c
,Apttus_QPConfig__BaseExtendedPrice__c
,Apttus_QPConfig__BasePrice__c
,Apttus_QPConfig__BasePriceOverride__c
,Apttus_QPConfig__BasePriceMethod__c
,Apttus_QPConfig__BillingFrequency__c
,Apttus_QPConfig__BillingPreferenceId__c
,Apttus_QPConfig__BillingRule__c
,Apttus_QPConfig__BillToAccountId__c
,SWT_Business_Area__c
,Apttus_QPConfig__ClassificationHierarchy__c
,SWT_Channel_CMT_MD_Lead_Queue__c
,SWT_Channel_Manager_Queue__c
,Apttus_QPConfig__ChargeType__c
,SWT_CMT_MD_Lead_Queue__c
,Apttus_QPConfig__Comments__c
,Apttus_QPConfig__CommitmentQuantity__c
,SWT_Container_Lines__c
,Apttus_QPConfig__ContractNumbers__c
,SWT_Contractual_Discount_Amount__c
,SWT_Contractual_Discount_Percentage__c
,Apttus_QPConfig__Cost__c
,Apttus_QPConfig__CouponCode__c
,SWT_CSR_Approvals__c
,SWT_CSR_Compensation__c
,SWT_Customer_Account_Reference__c
,SWT_Deal_Desk__c
,Apttus_QPConfig__DeltaPrice__c
,Apttus_QPConfig__DeltaQuantity__c
,Apttus_Proposal__Description__c
,SWT_Ad_Disc__c
,SWT_Cont_Disc__c
,SWT_Display_Disc_Perc__c
,SWT_Pr_Disc__c
,Apttus_QPConfig__EndDate__c
,Apttus_QPConfig__ExtendedCost__c
,Apttus_QPConfig__ExtendedDescription__c
,SWT_Extended_List_Price__c
,Apttus_QPConfig__ExtendedPrice__c
,SWT_Extended_Price_Template__c
,Apttus_QPConfig__ExtendedQuantity__c
,Apttus_Proposal__Ext_Net_Price__c
,Apttus_Proposal__Ext_Price__c
,SWT_First_Line_Manager_Queue__c
,Apttus_QPConfig__FlatOptionPrice__c
,Apttus_QPConfig__GroupAdjustmentPercent__c
,Apttus_QPConfig__Guidance__c
,Apttus_QPConfig__HasAttributes__c
,Apttus_QPConfig__HasIncentives__c
,Apttus_QPConfig__HasOptions__c
,Apttus_QPConfig__HideInvoiceDisplay__c
,SWT_HPE_Grace_Period__c
,SWT_HPE_RampUp__c
,Apttus_QPConfig__IncentiveAdjustmentAmount__c
,Apttus_QPConfig__IncentiveCode__c
,Apttus_QPConfig__IncentiveExtendedPrice__c
,Apttus_QPConfig__IncentiveType__c
,Apttus_QPConfig__IsAssetPricing__c
,Apttus_QPConfig__IsCustomPricing__c
,Apttus_QPConfig__IsOptionRollupLine__c
,Apttus_QPConfig__IsPrimaryLine__c
,Apttus_QPConfig__IsPrimaryRampLine__c
,Apttus_QPConfig__IsUsageTierModifiable__c
,Apttus_QPConfig__ItemSequence__c
,SWT_Jurisdiction_Text__c
,SWT_License_List_Price__c
,SWT_License_Net_Price__c
,Apttus_QPConfig__LineNumber__c
,Apttus_QPConfig__LineStatus__c
,Apttus_QPConfig__LineType__c
,Apttus_QPConfig__ListPrice__c
,SWT_List_Price_Template__c
,Apttus_QPConfig__LocationId__c
,SWT_Merged_Subscription__c
,Apttus_QPConfig__NetAdjustmentPercent__c
,Apttus_QPConfig__NetPrice__c
,SWT_Net_Price_Template__c
,Apttus_QPConfig__NetUnitPrice__c
,Apttus_QPConfig__OptionCost__c
,Apttus_QPConfig__OptionPrice__c
,SWT_Orange_Band_Threshold__c
,SWT_OrangeThresholdCheck__c
,SWT_OrangeThresholdCheckForSupport__c
,Apttus_QPConfig__ParentBundleNumber__c
,SWT_Partner_Discount_Amount__c
,SWT_Partner_Discount_Percentage__c
,Apttus_QPConfig__PaymentTermId__c
,SWT_Percentage_of_License_Net__c
,SWT_Percentage_Values__c
,Apttus_QPConfig__PriceAdjustment__c
,Apttus_QPConfig__PriceAdjustmentAmount__c
,Apttus_QPConfig__PriceAdjustmentType__c
,Apttus_QPConfig__PriceGroup__c
,Apttus_QPConfig__PriceIncludedInBundle__c
,Apttus_QPConfig__PriceListId__c
,Apttus_QPConfig__PriceMethod__c
,Apttus_QPConfig__PriceType__c
,Apttus_QPConfig__PricingDate__c
,Apttus_QPConfig__Frequency__c
,SWT_Pricing_Method__c
,Apttus_QPConfig__Term__c
,Apttus_QPConfig__PriceUom__c
,Apttus_QPConfig__PrimaryLineNumber__c
,SWT_Product_Code__c
,SWT_Product_Config_Type__c
,SWT_PL__c
,SWT_Product_Name_on_Template__c
,SWT_ProductRatePlanChargeID__c
,SWT_Product_Rate_Plan_Charge_ID__c
,SWT_Product_Sub_Type__c
,SWT_Product_Type__c
,SWT_Product_Type_Business__c
,SWT_ProductTypeForApprovals__c
,Apttus_QPConfig__Uom__c
,SWT_Promotional_Discount_Percentage__c
,SWT_Promotion_Discount_Amount__c
,SWT_PS_Level_2_Queue__c
,Apttus_Proposal__Quantity__c
,Apttus_QPConfig__Quantity2__c
,Quantity_Display__c
,Apttus_QPConfig__ReadyForActivationDate__c
,Apttus_QPConfig__ReadyForBillingDate__c
,Apttus_QPConfig__ReadyForFulfillmentDate__c
,Apttus_QPConfig__ReadyForRevRecDate__c
,SWT_Red_Band_Threshold__c
,SWT_RedThresholdCheck__c
,SWT_RedThresholdCheckForSupport__c
,SWT_RedThresholdCheckL3__c
,SWT_RedThresholdCheckL4__c
,SWT_RelatedProduct__c
,Apttus_QPConfig__RenewalAdjustmentAmount__c
,Apttus_QPConfig__RenewalAdjustmentType__c
,SWT_Return_to_Support__c
,SWT_SAAS_Approvals_Check__c
,SWT_Saas_L2_Approvals_Check__c
,Apttus_Proposal__Sales_Discount__c
,Apttus_QPConfig__SellingFrequency__c
,Apttus_QPConfig__SellingTerm__c
,Apttus_Proposal__Service_Date__c
,Apttus_QPConfig__ShipToAccountId__c
,SWT_Ship_To_Address__c
,Apttus_QPConfig__StartDate__c
,SWT_Support_Entitlement_ID__c
,SWT_Support_List_Price__c
,SWT_Support_Net_Price__c
,Apttus_QPConfig__Taxable__c
,SWT_Tax_Amount__c
,SWT_Tax_Code__c
,Apttus_QPConfig__TaxInclusive__c
,SWT_Tax_Rate__c
,SWT_Tax_Rate_Code__c
,SWT_Tax_Type__c
,SWT_Term_Template__c
,SWT_Tier_Type__c
,SWT_Total_Discount_Amount__c
,SWT_Total_Discount_Percentage__c
,Apttus_Proposal__Unit_Net_Price__c
,Apttus_Proposal__Unit_Price__c
,SWT_UOM_SoldByQuantity__c
,SW_UpfrontBilling__c
,SWT_VSOE_lower_band__c
,SWT_VSOE_upper_band__c
,SWT_VSOE_Value_Pricing__c
,SWT_Yellow_Band_Threshold__c
,SWT_YellowThresholdCheck__c
,SWT_YellowThresholdCheckForSupport__c
,SWT_ZuoraProductRatePlanID__c
,SWT_Zuora_Rate_Plan_Charge_ID__c
,LastModifiedDate
,SWT_Entitlement_Id__c
,SWT_Previous_Year_License_Net_Price__c
,SWT_Previous_Year_Support_Net_Price__c
,SWT_Is_Premier_Support__c
,SWT_O_Threshold_for_Display__c
,SWT_R_Threshold_for_Display__c
,SWT_Y_Threshold_for_Display__c
,SWT_Legacy_SAID__c
,SWT_Price_Method__c
,SWT_Product_Code_Sub_Type__c
,SWT_Asset_Line_Item__c
,SWT_ProductPillars__c
,SWT_DataSheets__c
,SWT_Skus__c
,SWT_Support_Business_Area__c
,SWT_Product_Tax_Code__c
,SWT_Expected_Start_Date__c
,SWT_SellingTerm__c
,SWT_Resource__c
,SWT_Expected_End_Date__c
,SWT_Quantity_Reduced__c
,SWT_SmartDiscount_Match__c
,SWT_SmartDiscount_Link__c
,SWT_Initial_Quantity_New_Business__c
,SWT_Product_Detail_Code__c
,SWT_UOM_code__c
,SWT_Profit_Center__c
,SWT_Remaining_Quantity__c
,SWT_Billing_Plan__c
,SWT_Sold_By_Pack__c
,SWT_Non_VSOE_Compliant__c
,SWT_Is_Renewed_Migrated__c
,SWT_Expected_Unit_Price_for_Renewals__c
,SWT_Previous_Year_Unit_Net_Price__c
,SWT_Net_Price_Xauthor__c
,SWT_Previous_Year_Support_Net_Xauthor__c
,SWT_Previous_Year_License_Net_Xauthor__c
,SWT_Product_Name__c
,SWT_Selling_Term__c
,SWT_Initial_Quantity_NB_Xauthor__c
,SWT_Quantity__c
,SWT_EOL_Date__c
,Name
,SWT_ELA_Agreement_Name__c
,SWT_ELA_Line_Item_Original_Balance__c
,SWT_ELA_Adjustment_Quantity__c
,SWT_ELA_Upper_Fence__c
,SWT_ELA_Lower_Fence__c
,SWT_ELA_Maximum_Quantity__c
,SWT_ELA_Complimentary__c
,SWT_ELA_Complimetary_Discount__c
,SWT_ELA_Complimetary_Product_Price__c
,SWT_Product_Billing_Plan__c
,SWT_Promotional_Discount_Checkbox__c
,SWT_Additional_Discount_Checkbox__c
,SWT_Contractual_Discount_Checkbox__c
,SWT_Program_Discount_Checkbox__c
,SWT_Royalty_Bearing_or_Fixed_Quantity_1__c
,SWT_Cancellation_Note_xauthor__c
,SWT_Cancellation_Reason_xauthor__c
,SWT_Cancellation_Type_xauthor__c
,SWT_Charge_Description__c
,IsDeleted
,CreatedDate
,SystemModstamp
,LastActivityDate
,Apttus_QPConfig__AssetId__c
,Apttus_QPConfig__AttributeValueId__c
,Apttus_QPConfig__ChargeGroupId__c
,SWT_Total_Discount_Value__c
,Apttus_QPConfig__ServiceLocationId__c
,SWT_Support_Level__c
,SWT_FamilyDescs__c
,SAAS_L4_BU_GM_Approval__c
,SWT_RenewalAdditionalAdjustmentType__c
,SWT_Program_Discount_Amount__c
,SWT_Program_Discount_Percentage__c
,SWT_RenewalAdditionalDiscount__c
,SWT_Renewal_Adjustment_Amount__c
,SWT_Renewal_Adjustment_Percentage__c
,Apttus_QPConfig__IsOptional__c
,SWT_Zuora_Subscription_Rate_Plan_ID__c
,SWT_Original_Quantity__c
,SWT_Appliance_Serial_Number__c
,SWT_Ship_To_Xauthor__c
,SWT_Renewing_EL_Product__c
,SWT_Proposal_Line_Item__c
,SWT_Discount_Level__c
,SWT_Discount_Level_Number__c
,SWT_Education_Approval_Check_1__c
,SWT_PS_Level_2_Approval_Check__c
,SWT_PS_Level_3_Approval_Check__c
,SWT_LI_Approval_Status__c
,SWT_Control_Tower_ID__c
,SWT_Line_Type__c
,SWT_Termination_Quantity__c
,SWT_Initial_Zuora_Rate_Plan_Charge_ID__c
,SYSDATE AS LD_DT
,SWT_INS_DT
,'base'
FROM "swt_rpt_base".AT_Apttus_Proposal__Proposal_Line_Item__c WHERE id in
(SELECT STG.id FROM AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp_Key STG JOIN AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp
ON STG.id = AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp.id AND STG.LastModifiedDate >= AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp.LastModifiedDate);

/* Deleting before seven days data from current date in the Historical Table */

delete /*+DIRECT*/ from "swt_rpt_stg"."AT_Apttus_Proposal__Proposal_Line_Item__c_Hist"  where LD_DT::date <= TIMESTAMPADD(DAY,-7,sysdate)::date;


/* Incremental VSQL script for loading data from Stage to Base */

DELETE /*+DIRECT*/ FROM "swt_rpt_base".AT_Apttus_Proposal__Proposal_Line_Item__c WHERE id in
(SELECT STG.id FROM AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp_Key STG JOIN AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp
ON STG.id = AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp.id AND STG.LastModifiedDate >= AT_Apttus_Proposal__Proposal_Line_Item__c_base_Tmp.LastModifiedDate);

INSERT /*+DIRECT*/ INTO "swt_rpt_base".AT_Apttus_Proposal__Proposal_Line_Item__c
(
Id
,Apttus_QPConfig__AssetLineItemId__c
,Apttus_QPConfig__BaseProductId__c
,Apttus_QPConfig__BillingPlanId__c
,Apttus_QPConfig__ClassificationId__c
,Apttus_QPConfig__ConfigurationId__c
,Apttus_QPConfig__DerivedFromId__c
,Apttus_QPConfig__IncentiveId__c
,Apttus_QPConfig__OptionId__c
,SWT_ParentProposalLineItem__c
,Apttus_QPConfig__PriceListItemId__c
,Apttus_Proposal__Product__c
,Apttus_QPConfig__ProductOptionId__c
,Apttus_Proposal__Proposal__c
,Apttus_QPConfig__SummaryGroupId__c
,Apttus_QPConfig__TaxCodeId__c
,CreatedById
,CurrencyIsoCode
,LastModifiedById
,SWT_Additional_Discount__c
,SWT_Additional_Discount_Percentage__c
,Apttus_QPConfig__AdjustedPrice__c
,Apttus_QPConfig__AdjustmentAmount__c
,Apttus_QPConfig__AdjustmentType__c
,SWT_Advanced_Support_Resource__c
,Apttus_QPApprov__Approval_Status__c
,SWT_Authority_Currency_Code__c
,Apttus_QPConfig__AutoActivateOrder__c
,Apttus_QPConfig__AutoCreateBill__c
,Apttus_QPConfig__AutoCreateRevenue__c
,Apttus_QPConfig__AutoRenew__c
,Apttus_QPConfig__AutoRenewalTerm__c
,Apttus_QPConfig__AutoRenewalType__c
,Apttus_QPConfig__BaseCost__c
,Apttus_QPConfig__BaseCostOverride__c
,Apttus_QPConfig__BaseExtendedCost__c
,Apttus_QPConfig__BaseExtendedPrice__c
,Apttus_QPConfig__BasePrice__c
,Apttus_QPConfig__BasePriceOverride__c
,Apttus_QPConfig__BasePriceMethod__c
,Apttus_QPConfig__BillingFrequency__c
,Apttus_QPConfig__BillingPreferenceId__c
,Apttus_QPConfig__BillingRule__c
,Apttus_QPConfig__BillToAccountId__c
,SWT_Business_Area__c
,Apttus_QPConfig__ClassificationHierarchy__c
,SWT_Channel_CMT_MD_Lead_Queue__c
,SWT_Channel_Manager_Queue__c
,Apttus_QPConfig__ChargeType__c
,SWT_CMT_MD_Lead_Queue__c
,Apttus_QPConfig__Comments__c
,Apttus_QPConfig__CommitmentQuantity__c
,SWT_Container_Lines__c
,Apttus_QPConfig__ContractNumbers__c
,SWT_Contractual_Discount_Amount__c
,SWT_Contractual_Discount_Percentage__c
,Apttus_QPConfig__Cost__c
,Apttus_QPConfig__CouponCode__c
,SWT_CSR_Approvals__c
,SWT_CSR_Compensation__c
,SWT_Customer_Account_Reference__c
,SWT_Deal_Desk__c
,Apttus_QPConfig__DeltaPrice__c
,Apttus_QPConfig__DeltaQuantity__c
,Apttus_Proposal__Description__c
,SWT_Ad_Disc__c
,SWT_Cont_Disc__c
,SWT_Display_Disc_Perc__c
,SWT_Pr_Disc__c
,Apttus_QPConfig__EndDate__c
,Apttus_QPConfig__ExtendedCost__c
,Apttus_QPConfig__ExtendedDescription__c
,SWT_Extended_List_Price__c
,Apttus_QPConfig__ExtendedPrice__c
,SWT_Extended_Price_Template__c
,Apttus_QPConfig__ExtendedQuantity__c
,Apttus_Proposal__Ext_Net_Price__c
,Apttus_Proposal__Ext_Price__c
,SWT_First_Line_Manager_Queue__c
,Apttus_QPConfig__FlatOptionPrice__c
,Apttus_QPConfig__GroupAdjustmentPercent__c
,Apttus_QPConfig__Guidance__c
,Apttus_QPConfig__HasAttributes__c
,Apttus_QPConfig__HasIncentives__c
,Apttus_QPConfig__HasOptions__c
,Apttus_QPConfig__HideInvoiceDisplay__c
,SWT_HPE_Grace_Period__c
,SWT_HPE_RampUp__c
,Apttus_QPConfig__IncentiveAdjustmentAmount__c
,Apttus_QPConfig__IncentiveCode__c
,Apttus_QPConfig__IncentiveExtendedPrice__c
,Apttus_QPConfig__IncentiveType__c
,Apttus_QPConfig__IsAssetPricing__c
,Apttus_QPConfig__IsCustomPricing__c
,Apttus_QPConfig__IsOptionRollupLine__c
,Apttus_QPConfig__IsPrimaryLine__c
,Apttus_QPConfig__IsPrimaryRampLine__c
,Apttus_QPConfig__IsUsageTierModifiable__c
,Apttus_QPConfig__ItemSequence__c
,SWT_Jurisdiction_Text__c
,SWT_License_List_Price__c
,SWT_License_Net_Price__c
,Apttus_QPConfig__LineNumber__c
,Apttus_QPConfig__LineStatus__c
,Apttus_QPConfig__LineType__c
,Apttus_QPConfig__ListPrice__c
,SWT_List_Price_Template__c
,Apttus_QPConfig__LocationId__c
,SWT_Merged_Subscription__c
,Apttus_QPConfig__NetAdjustmentPercent__c
,Apttus_QPConfig__NetPrice__c
,SWT_Net_Price_Template__c
,Apttus_QPConfig__NetUnitPrice__c
,Apttus_QPConfig__OptionCost__c
,Apttus_QPConfig__OptionPrice__c
,SWT_Orange_Band_Threshold__c
,SWT_OrangeThresholdCheck__c
,SWT_OrangeThresholdCheckForSupport__c
,Apttus_QPConfig__ParentBundleNumber__c
,SWT_Partner_Discount_Amount__c
,SWT_Partner_Discount_Percentage__c
,Apttus_QPConfig__PaymentTermId__c
,SWT_Percentage_of_License_Net__c
,SWT_Percentage_Values__c
,Apttus_QPConfig__PriceAdjustment__c
,Apttus_QPConfig__PriceAdjustmentAmount__c
,Apttus_QPConfig__PriceAdjustmentType__c
,Apttus_QPConfig__PriceGroup__c
,Apttus_QPConfig__PriceIncludedInBundle__c
,Apttus_QPConfig__PriceListId__c
,Apttus_QPConfig__PriceMethod__c
,Apttus_QPConfig__PriceType__c
,Apttus_QPConfig__PricingDate__c
,Apttus_QPConfig__Frequency__c
,SWT_Pricing_Method__c
,Apttus_QPConfig__Term__c
,Apttus_QPConfig__PriceUom__c
,Apttus_QPConfig__PrimaryLineNumber__c
,SWT_Product_Code__c
,SWT_Product_Config_Type__c
,SWT_PL__c
,SWT_Product_Name_on_Template__c
,SWT_ProductRatePlanChargeID__c
,SWT_Product_Rate_Plan_Charge_ID__c
,SWT_Product_Sub_Type__c
,SWT_Product_Type__c
,SWT_Product_Type_Business__c
,SWT_ProductTypeForApprovals__c
,Apttus_QPConfig__Uom__c
,SWT_Promotional_Discount_Percentage__c
,SWT_Promotion_Discount_Amount__c
,SWT_PS_Level_2_Queue__c
,Apttus_Proposal__Quantity__c
,Apttus_QPConfig__Quantity2__c
,Quantity_Display__c
,Apttus_QPConfig__ReadyForActivationDate__c
,Apttus_QPConfig__ReadyForBillingDate__c
,Apttus_QPConfig__ReadyForFulfillmentDate__c
,Apttus_QPConfig__ReadyForRevRecDate__c
,SWT_Red_Band_Threshold__c
,SWT_RedThresholdCheck__c
,SWT_RedThresholdCheckForSupport__c
,SWT_RedThresholdCheckL3__c
,SWT_RedThresholdCheckL4__c
,SWT_RelatedProduct__c
,Apttus_QPConfig__RenewalAdjustmentAmount__c
,Apttus_QPConfig__RenewalAdjustmentType__c
,SWT_Return_to_Support__c
,SWT_SAAS_Approvals_Check__c
,SWT_Saas_L2_Approvals_Check__c
,Apttus_Proposal__Sales_Discount__c
,Apttus_QPConfig__SellingFrequency__c
,Apttus_QPConfig__SellingTerm__c
,Apttus_Proposal__Service_Date__c
,Apttus_QPConfig__ShipToAccountId__c
,SWT_Ship_To_Address__c
,Apttus_QPConfig__StartDate__c
,SWT_Support_Entitlement_ID__c
,SWT_Support_List_Price__c
,SWT_Support_Net_Price__c
,Apttus_QPConfig__Taxable__c
,SWT_Tax_Amount__c
,SWT_Tax_Code__c
,Apttus_QPConfig__TaxInclusive__c
,SWT_Tax_Rate__c
,SWT_Tax_Rate_Code__c
,SWT_Tax_Type__c
,SWT_Term_Template__c
,SWT_Tier_Type__c
,SWT_Total_Discount_Amount__c
,SWT_Total_Discount_Percentage__c
,Apttus_Proposal__Unit_Net_Price__c
,Apttus_Proposal__Unit_Price__c
,SWT_UOM_SoldByQuantity__c
,SW_UpfrontBilling__c
,SWT_VSOE_lower_band__c
,SWT_VSOE_upper_band__c
,SWT_VSOE_Value_Pricing__c
,SWT_Yellow_Band_Threshold__c
,SWT_YellowThresholdCheck__c
,SWT_YellowThresholdCheckForSupport__c
,SWT_ZuoraProductRatePlanID__c
,SWT_Zuora_Rate_Plan_Charge_ID__c
,LastModifiedDate
,SWT_Entitlement_Id__c
,SWT_Previous_Year_License_Net_Price__c
,SWT_Previous_Year_Support_Net_Price__c
,SWT_Is_Premier_Support__c
,SWT_O_Threshold_for_Display__c
,SWT_R_Threshold_for_Display__c
,SWT_Y_Threshold_for_Display__c
,SWT_Legacy_SAID__c
,SWT_Price_Method__c
,SWT_Product_Code_Sub_Type__c
,SWT_Asset_Line_Item__c
,SWT_ProductPillars__c
,SWT_DataSheets__c
,SWT_Skus__c
,SWT_Support_Business_Area__c
,SWT_Product_Tax_Code__c
,SWT_Expected_Start_Date__c
,SWT_SellingTerm__c
,SWT_Resource__c
,SWT_Expected_End_Date__c
,SWT_Quantity_Reduced__c
,SWT_SmartDiscount_Match__c
,SWT_SmartDiscount_Link__c
,SWT_Initial_Quantity_New_Business__c
,SWT_Product_Detail_Code__c
,SWT_UOM_code__c
,SWT_Profit_Center__c
,SWT_Remaining_Quantity__c
,SWT_Billing_Plan__c
,SWT_Sold_By_Pack__c
,SWT_Non_VSOE_Compliant__c
,SWT_Is_Renewed_Migrated__c
,SWT_Expected_Unit_Price_for_Renewals__c
,SWT_Previous_Year_Unit_Net_Price__c
,SWT_Net_Price_Xauthor__c
,SWT_Previous_Year_Support_Net_Xauthor__c
,SWT_Previous_Year_License_Net_Xauthor__c
,SWT_Product_Name__c
,SWT_Selling_Term__c
,SWT_Initial_Quantity_NB_Xauthor__c
,SWT_Quantity__c
,SWT_EOL_Date__c
,Name
,SWT_ELA_Agreement_Name__c
,SWT_ELA_Line_Item_Original_Balance__c
,SWT_ELA_Adjustment_Quantity__c
,SWT_ELA_Upper_Fence__c
,SWT_ELA_Lower_Fence__c
,SWT_ELA_Maximum_Quantity__c
,SWT_ELA_Complimentary__c
,SWT_ELA_Complimetary_Discount__c
,SWT_ELA_Complimetary_Product_Price__c
,SWT_Product_Billing_Plan__c
,SWT_Promotional_Discount_Checkbox__c
,SWT_Additional_Discount_Checkbox__c
,SWT_Contractual_Discount_Checkbox__c
,SWT_Program_Discount_Checkbox__c
,SWT_Royalty_Bearing_or_Fixed_Quantity_1__c
,SWT_Cancellation_Note_xauthor__c
,SWT_Cancellation_Reason_xauthor__c
,SWT_Cancellation_Type_xauthor__c
,SWT_Charge_Description__c
,IsDeleted
,CreatedDate
,SystemModstamp
,LastActivityDate
,Apttus_QPConfig__AssetId__c
,Apttus_QPConfig__AttributeValueId__c
,Apttus_QPConfig__ChargeGroupId__c
,SWT_Total_Discount_Value__c
,Apttus_QPConfig__ServiceLocationId__c
,SWT_Support_Level__c
,SWT_FamilyDescs__c
,SAAS_L4_BU_GM_Approval__c
,SWT_RenewalAdditionalAdjustmentType__c
,SWT_Program_Discount_Amount__c
,SWT_Program_Discount_Percentage__c
,SWT_RenewalAdditionalDiscount__c
,SWT_Renewal_Adjustment_Amount__c
,SWT_Renewal_Adjustment_Percentage__c
,Apttus_QPConfig__IsOptional__c
,SWT_Zuora_Subscription_Rate_Plan_ID__c
,SWT_Original_Quantity__c
,SWT_Appliance_Serial_Number__c
,SWT_Ship_To_Xauthor__c
,SWT_Renewing_EL_Product__c
,SWT_Proposal_Line_Item__c
,SWT_Discount_Level__c
,SWT_Discount_Level_Number__c
,SWT_Education_Approval_Check_1__c
,SWT_PS_Level_2_Approval_Check__c
,SWT_PS_Level_3_Approval_Check__c
,SWT_LI_Approval_Status__c
,SWT_Control_Tower_ID__c
,SWT_Line_Type__c
,SWT_Termination_Quantity__c
,SWT_Initial_Zuora_Rate_Plan_Charge_ID__c
,SWT_INS_DT
)
SELECT DISTINCT 
AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp.Id
,Apttus_QPConfig__AssetLineItemId__c
,Apttus_QPConfig__BaseProductId__c
,Apttus_QPConfig__BillingPlanId__c
,Apttus_QPConfig__ClassificationId__c
,Apttus_QPConfig__ConfigurationId__c
,Apttus_QPConfig__DerivedFromId__c
,Apttus_QPConfig__IncentiveId__c
,Apttus_QPConfig__OptionId__c
,SWT_ParentProposalLineItem__c
,Apttus_QPConfig__PriceListItemId__c
,Apttus_Proposal__Product__c
,Apttus_QPConfig__ProductOptionId__c
,Apttus_Proposal__Proposal__c
,Apttus_QPConfig__SummaryGroupId__c
,Apttus_QPConfig__TaxCodeId__c
,CreatedById
,CurrencyIsoCode
,LastModifiedById
,SWT_Additional_Discount__c
,SWT_Additional_Discount_Percentage__c
,Apttus_QPConfig__AdjustedPrice__c
,Apttus_QPConfig__AdjustmentAmount__c
,Apttus_QPConfig__AdjustmentType__c
,SWT_Advanced_Support_Resource__c
,Apttus_QPApprov__Approval_Status__c
,SWT_Authority_Currency_Code__c
,Apttus_QPConfig__AutoActivateOrder__c
,Apttus_QPConfig__AutoCreateBill__c
,Apttus_QPConfig__AutoCreateRevenue__c
,Apttus_QPConfig__AutoRenew__c
,Apttus_QPConfig__AutoRenewalTerm__c
,Apttus_QPConfig__AutoRenewalType__c
,Apttus_QPConfig__BaseCost__c
,Apttus_QPConfig__BaseCostOverride__c
,Apttus_QPConfig__BaseExtendedCost__c
,Apttus_QPConfig__BaseExtendedPrice__c
,Apttus_QPConfig__BasePrice__c
,Apttus_QPConfig__BasePriceOverride__c
,Apttus_QPConfig__BasePriceMethod__c
,Apttus_QPConfig__BillingFrequency__c
,Apttus_QPConfig__BillingPreferenceId__c
,Apttus_QPConfig__BillingRule__c
,Apttus_QPConfig__BillToAccountId__c
,SWT_Business_Area__c
,Apttus_QPConfig__ClassificationHierarchy__c
,SWT_Channel_CMT_MD_Lead_Queue__c
,SWT_Channel_Manager_Queue__c
,Apttus_QPConfig__ChargeType__c
,SWT_CMT_MD_Lead_Queue__c
,Apttus_QPConfig__Comments__c
,Apttus_QPConfig__CommitmentQuantity__c
,SWT_Container_Lines__c
,Apttus_QPConfig__ContractNumbers__c
,SWT_Contractual_Discount_Amount__c
,SWT_Contractual_Discount_Percentage__c
,Apttus_QPConfig__Cost__c
,Apttus_QPConfig__CouponCode__c
,SWT_CSR_Approvals__c
,SWT_CSR_Compensation__c
,SWT_Customer_Account_Reference__c
,SWT_Deal_Desk__c
,Apttus_QPConfig__DeltaPrice__c
,Apttus_QPConfig__DeltaQuantity__c
,Apttus_Proposal__Description__c
,SWT_Ad_Disc__c
,SWT_Cont_Disc__c
,SWT_Display_Disc_Perc__c
,SWT_Pr_Disc__c
,Apttus_QPConfig__EndDate__c
,Apttus_QPConfig__ExtendedCost__c
,Apttus_QPConfig__ExtendedDescription__c
,SWT_Extended_List_Price__c
,Apttus_QPConfig__ExtendedPrice__c
,SWT_Extended_Price_Template__c
,Apttus_QPConfig__ExtendedQuantity__c
,Apttus_Proposal__Ext_Net_Price__c
,Apttus_Proposal__Ext_Price__c
,SWT_First_Line_Manager_Queue__c
,Apttus_QPConfig__FlatOptionPrice__c
,Apttus_QPConfig__GroupAdjustmentPercent__c
,Apttus_QPConfig__Guidance__c
,Apttus_QPConfig__HasAttributes__c
,Apttus_QPConfig__HasIncentives__c
,Apttus_QPConfig__HasOptions__c
,Apttus_QPConfig__HideInvoiceDisplay__c
,SWT_HPE_Grace_Period__c
,SWT_HPE_RampUp__c
,Apttus_QPConfig__IncentiveAdjustmentAmount__c
,Apttus_QPConfig__IncentiveCode__c
,Apttus_QPConfig__IncentiveExtendedPrice__c
,Apttus_QPConfig__IncentiveType__c
,Apttus_QPConfig__IsAssetPricing__c
,Apttus_QPConfig__IsCustomPricing__c
,Apttus_QPConfig__IsOptionRollupLine__c
,Apttus_QPConfig__IsPrimaryLine__c
,Apttus_QPConfig__IsPrimaryRampLine__c
,Apttus_QPConfig__IsUsageTierModifiable__c
,Apttus_QPConfig__ItemSequence__c
,SWT_Jurisdiction_Text__c
,SWT_License_List_Price__c
,SWT_License_Net_Price__c
,Apttus_QPConfig__LineNumber__c
,Apttus_QPConfig__LineStatus__c
,Apttus_QPConfig__LineType__c
,Apttus_QPConfig__ListPrice__c
,SWT_List_Price_Template__c
,Apttus_QPConfig__LocationId__c
,SWT_Merged_Subscription__c
,Apttus_QPConfig__NetAdjustmentPercent__c
,Apttus_QPConfig__NetPrice__c
,SWT_Net_Price_Template__c
,Apttus_QPConfig__NetUnitPrice__c
,Apttus_QPConfig__OptionCost__c
,Apttus_QPConfig__OptionPrice__c
,SWT_Orange_Band_Threshold__c
,SWT_OrangeThresholdCheck__c
,SWT_OrangeThresholdCheckForSupport__c
,Apttus_QPConfig__ParentBundleNumber__c
,SWT_Partner_Discount_Amount__c
,SWT_Partner_Discount_Percentage__c
,Apttus_QPConfig__PaymentTermId__c
,SWT_Percentage_of_License_Net__c
,SWT_Percentage_Values__c
,Apttus_QPConfig__PriceAdjustment__c
,Apttus_QPConfig__PriceAdjustmentAmount__c
,Apttus_QPConfig__PriceAdjustmentType__c
,Apttus_QPConfig__PriceGroup__c
,Apttus_QPConfig__PriceIncludedInBundle__c
,Apttus_QPConfig__PriceListId__c
,Apttus_QPConfig__PriceMethod__c
,Apttus_QPConfig__PriceType__c
,Apttus_QPConfig__PricingDate__c
,Apttus_QPConfig__Frequency__c
,SWT_Pricing_Method__c
,Apttus_QPConfig__Term__c
,Apttus_QPConfig__PriceUom__c
,Apttus_QPConfig__PrimaryLineNumber__c
,SWT_Product_Code__c
,SWT_Product_Config_Type__c
,SWT_PL__c
,SWT_Product_Name_on_Template__c
,SWT_ProductRatePlanChargeID__c
,SWT_Product_Rate_Plan_Charge_ID__c
,SWT_Product_Sub_Type__c
,SWT_Product_Type__c
,SWT_Product_Type_Business__c
,SWT_ProductTypeForApprovals__c
,Apttus_QPConfig__Uom__c
,SWT_Promotional_Discount_Percentage__c
,SWT_Promotion_Discount_Amount__c
,SWT_PS_Level_2_Queue__c
,Apttus_Proposal__Quantity__c
,Apttus_QPConfig__Quantity2__c
,Quantity_Display__c
,Apttus_QPConfig__ReadyForActivationDate__c
,Apttus_QPConfig__ReadyForBillingDate__c
,Apttus_QPConfig__ReadyForFulfillmentDate__c
,Apttus_QPConfig__ReadyForRevRecDate__c
,SWT_Red_Band_Threshold__c
,SWT_RedThresholdCheck__c
,SWT_RedThresholdCheckForSupport__c
,SWT_RedThresholdCheckL3__c
,SWT_RedThresholdCheckL4__c
,SWT_RelatedProduct__c
,Apttus_QPConfig__RenewalAdjustmentAmount__c
,Apttus_QPConfig__RenewalAdjustmentType__c
,SWT_Return_to_Support__c
,SWT_SAAS_Approvals_Check__c
,SWT_Saas_L2_Approvals_Check__c
,Apttus_Proposal__Sales_Discount__c
,Apttus_QPConfig__SellingFrequency__c
,Apttus_QPConfig__SellingTerm__c
,Apttus_Proposal__Service_Date__c
,Apttus_QPConfig__ShipToAccountId__c
,SWT_Ship_To_Address__c
,Apttus_QPConfig__StartDate__c
,SWT_Support_Entitlement_ID__c
,SWT_Support_List_Price__c
,SWT_Support_Net_Price__c
,Apttus_QPConfig__Taxable__c
,SWT_Tax_Amount__c
,SWT_Tax_Code__c
,Apttus_QPConfig__TaxInclusive__c
,SWT_Tax_Rate__c
,SWT_Tax_Rate_Code__c
,SWT_Tax_Type__c
,SWT_Term_Template__c
,SWT_Tier_Type__c
,SWT_Total_Discount_Amount__c
,SWT_Total_Discount_Percentage__c
,Apttus_Proposal__Unit_Net_Price__c
,Apttus_Proposal__Unit_Price__c
,SWT_UOM_SoldByQuantity__c
,SW_UpfrontBilling__c
,SWT_VSOE_lower_band__c
,SWT_VSOE_upper_band__c
,SWT_VSOE_Value_Pricing__c
,SWT_Yellow_Band_Threshold__c
,SWT_YellowThresholdCheck__c
,SWT_YellowThresholdCheckForSupport__c
,SWT_ZuoraProductRatePlanID__c
,SWT_Zuora_Rate_Plan_Charge_ID__c
,AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp.LastModifiedDate
,SWT_Entitlement_Id__c
,SWT_Previous_Year_License_Net_Price__c
,SWT_Previous_Year_Support_Net_Price__c
,SWT_Is_Premier_Support__c
,SWT_O_Threshold_for_Display__c
,SWT_R_Threshold_for_Display__c
,SWT_Y_Threshold_for_Display__c
,SWT_Legacy_SAID__c
,SWT_Price_Method__c
,SWT_Product_Code_Sub_Type__c
,SWT_Asset_Line_Item__c
,SWT_ProductPillars__c
,SWT_DataSheets__c
,SWT_Skus__c
,SWT_Support_Business_Area__c
,SWT_Product_Tax_Code__c
,SWT_Expected_Start_Date__c
,SWT_SellingTerm__c
,SWT_Resource__c
,SWT_Expected_End_Date__c
,SWT_Quantity_Reduced__c
,SWT_SmartDiscount_Match__c
,SWT_SmartDiscount_Link__c
,SWT_Initial_Quantity_New_Business__c
,SWT_Product_Detail_Code__c
,SWT_UOM_code__c
,SWT_Profit_Center__c
,SWT_Remaining_Quantity__c
,SWT_Billing_Plan__c
,SWT_Sold_By_Pack__c
,SWT_Non_VSOE_Compliant__c
,SWT_Is_Renewed_Migrated__c
,SWT_Expected_Unit_Price_for_Renewals__c
,SWT_Previous_Year_Unit_Net_Price__c
,SWT_Net_Price_Xauthor__c
,SWT_Previous_Year_Support_Net_Xauthor__c
,SWT_Previous_Year_License_Net_Xauthor__c
,SWT_Product_Name__c
,SWT_Selling_Term__c
,SWT_Initial_Quantity_NB_Xauthor__c
,SWT_Quantity__c
,SWT_EOL_Date__c
,Name
,SWT_ELA_Agreement_Name__c
,SWT_ELA_Line_Item_Original_Balance__c
,SWT_ELA_Adjustment_Quantity__c
,SWT_ELA_Upper_Fence__c
,SWT_ELA_Lower_Fence__c
,SWT_ELA_Maximum_Quantity__c
,SWT_ELA_Complimentary__c
,SWT_ELA_Complimetary_Discount__c
,SWT_ELA_Complimetary_Product_Price__c
,SWT_Product_Billing_Plan__c
,SWT_Promotional_Discount_Checkbox__c
,SWT_Additional_Discount_Checkbox__c
,SWT_Contractual_Discount_Checkbox__c
,SWT_Program_Discount_Checkbox__c
,SWT_Royalty_Bearing_or_Fixed_Quantity_1__c
,SWT_Cancellation_Note_xauthor__c
,SWT_Cancellation_Reason_xauthor__c
,SWT_Cancellation_Type_xauthor__c
,SWT_Charge_Description__c
,IsDeleted
,CreatedDate
,SystemModstamp
,LastActivityDate
,Apttus_QPConfig__AssetId__c
,Apttus_QPConfig__AttributeValueId__c
,Apttus_QPConfig__ChargeGroupId__c
,SWT_Total_Discount_Value__c
,Apttus_QPConfig__ServiceLocationId__c
,SWT_Support_Level__c
,SWT_FamilyDescs__c
,SAAS_L4_BU_GM_Approval__c
,SWT_RenewalAdditionalAdjustmentType__c
,SWT_Program_Discount_Amount__c
,SWT_Program_Discount_Percentage__c
,SWT_RenewalAdditionalDiscount__c
,SWT_Renewal_Adjustment_Amount__c
,SWT_Renewal_Adjustment_Percentage__c
,Apttus_QPConfig__IsOptional__c
,SWT_Zuora_Subscription_Rate_Plan_ID__c
,SWT_Original_Quantity__c
,SWT_Appliance_Serial_Number__c
,SWT_Ship_To_Xauthor__c
,SWT_Renewing_EL_Product__c
,SWT_Proposal_Line_Item__c
,SWT_Discount_Level__c
,SWT_Discount_Level_Number__c
,SWT_Education_Approval_Check_1__c
,SWT_PS_Level_2_Approval_Check__c
,SWT_PS_Level_3_Approval_Check__c
,SWT_LI_Approval_Status__c
,SWT_Control_Tower_ID__c
,SWT_Line_Type__c
,SWT_Termination_Quantity__c
,SWT_Initial_Zuora_Rate_Plan_Charge_ID__c
,SYSDATE
FROM AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp JOIN AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp_Key ON AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp.id= AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp_Key.id AND AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp.LastModifiedDate=AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp_Key.LastModifiedDate
WHERE NOT EXISTS
(SELECT 1 FROM "swt_rpt_base".AT_Apttus_Proposal__Proposal_Line_Item__c BASE
WHERE AT_Apttus_Proposal__Proposal_Line_Item__c_stg_Tmp.id = BASE.id);


/* Deleting partial audit entry */

DELETE FROM swt_rpt_stg.FAST_LD_AUDT where SUBJECT_AREA = 'APTTUS' and
TBL_NM = 'AT_Apttus_Proposal__Proposal_Line_Item__c' and
COMPLTN_STAT = 'N' and
LD_DT=sysdate::date and 
SEQ_ID = (select max(SEQ_ID) from swt_rpt_stg.FAST_LD_AUDT where  SUBJECT_AREA = 'APTTUS' and  TBL_NM = 'AT_Apttus_Proposal__Proposal_Line_Item__c' and  COMPLTN_STAT = 'N');


/* Inserting new audit entry with all stats */

INSERT INTO swt_rpt_stg.FAST_LD_AUDT
(
SUBJECT_AREA
,TBL_NM
,LD_DT
,START_DT_TIME
,END_DT_TIME
,SRC_REC_CNT
,TGT_REC_CNT
,COMPLTN_STAT
)
select 'APTTUS','AT_Apttus_Proposal__Proposal_Line_Item__c',sysdate::date,(select st from Start_Time_Tmp),sysdate,(select count from Start_Time_Tmp) ,(select count(*) from swt_rpt_base.AT_Apttus_Proposal__Proposal_Line_Item__c where SWT_INS_DT::date = sysdate::date),'Y';

Commit;

select do_tm_task('mergeout','swt_rpt_stg.AT_Apttus_Proposal__Proposal_Line_Item__c_Hist');
select do_tm_task('mergeout','swt_rpt_base.AT_Apttus_Proposal__Proposal_Line_Item__c');
select do_tm_task('mergeout','swt_rpt_stg.FAST_LD_AUDT');
SELECT ANALYZE_STATISTICS('swt_rpt_base.AT_Apttus_Proposal__Proposal_Line_Item__c');



